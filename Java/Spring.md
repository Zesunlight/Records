# Spring

## IoC

### 概念

- 容器及其管理的组件所提供的好处是可插拔的体系结构。组件需要实现一些接口，并且可以通过类似的接口访问其他组件所提供的服务。组件不需要知道这些服务的具体实现类。因此，可以非常容易地使用一个不同的实现替换系统中的任何组件。而容器的工作则是创建这些组件以及所依赖的服务并将这些组件装配在一起。
- 在组件类中，不需要使用新的操作符来实例化依赖组件，而是在运行时由容器实例将依赖组件注入组件。因此，对依赖项的控制由组件转到容器。这种模式被称为控制反转（Inversion of Controll）。

- 依赖注入可以通过setter方法注入、构造器Cibstruct注入和接口注入三种方式来实现，Spring支持setter注入和构造器注入，通常使用构造器注入来注入必须的依赖关系，对于可选的依赖关系，则setter注入是更好的选择

- IoC被认为是任何容器都需要提供的基本功能之一。它主要有两种形式：依赖查找（dependency lookup）和依赖注入（dependency injectien）。

### 依赖查找

在依赖查找中，容器向其管理的组件提供了回调方法，而组件则通过这些回调方法与容器进行交互并显式地获取它们的依赖项。

这种情况下，通常使用一个查找上下文来访问依赖组件以及容器管理的其他资源。

### 依赖注入

在依赖注入中，组件提供了合适的构造函数或 Setter 方法，以便容器可以注入依赖组件。

一般来说，很少在组件内执行显式依赖查找，大多数情况下，是通过构造函数或 Setter 方法在创建组件的时候注入依赖项

#### Setter 注入

- 当一个对象被容器实例化之后就会马上调用 Setter 方法

- 该注入在组件的创建或初始化阶段发生，并且在处理业务方法调用之前完成
- Setter注入的优点是在组件创建之后可以进行重新配置。组件的依赖项可以在运行时更改。换句话说，这些类提供了Getter Setter方法来访问它们的属性。
- Setter注入的缺点是：并不是所有所需的依赖项都可以在使用前被注入，从而使组件处于一种部分配置状态。
- 某些情况下，调用 Setter方法的顺序可能非常重要，而该顺序无法在组件约定中得以表达。因此，在创建阶段，容器提供了相关机制来探测并防止此类组件状态不一致的情况发生。

#### 构造函数注入

- 通过构造函数注入，Bean可以利用构造函数参数来表达依赖项，这样就可以在组件创建期间注入依赖项。
- 优点是可以保证容器中每一个被管理的组件都处于致状态，并且在创建之后可以马上使用。
- 缺点是在组件创建完毕后就无法再对组件进行重新配置，除非为相关属性提供一个 Setter 作为构造函数参数。为不同的配置选项创建多个重载构造函数可能会造成混乱，在大多数情况下甚至是无法使用的。
- 可能造成循环依赖

### 杂项

- IoC（Inverse of Control:控制反转）是一种**设计思想**，就是将原本在程序中手动创建对象的控制权，交由Spring框架来管理。对象的生命周期由Spring来管理，直接从Spring那里去获取一个对象。
- IoC 容器是 Spring 用来实现 IoC 的载体， IoC 容器实际上就是个Map（key，value）,Map 中存放的是各种对象。
- 将对象之间的相互依赖关系交给 IoC 容器来管理，并由 IoC 容器完成对象的注入。这样可以很大程度上简化应用的开发，把应用从复杂的依赖关系中解放出来。
- IoC 容器就像是一个工厂一样，当我们需要创建一个对象的时候，只需要配置好配置文件/注解即可，完全不用考虑对象是如何被创建出来的。
- ioc的思想最核心的地方在于，资源不由使用资源的双方管理，而由不使用资源的第三方管理，这可以带来很多好处。第一，资源集中管理，实现资源的可配置和易管理。第二，降低了使用资源双方的依赖程度，也就是我们说的耦合度。

### AOP

- AOP(Aspect-Oriented Programming：面向切面编程)能够将那些与业务无关，却为业务模块所共同调用的逻辑或责任（例如事务处理、日志管理、权限控制等）封装起来，便于减少系统的重复代码，降低模块间的耦合度，并有利于未来的可拓展性和可维护性。

- Spring AOP就是基于动态代理的
- 在不改变原有业务逻辑的情况下，增强横切逻辑代码，根本上解耦合，避免横切逻辑代码重复。
- AOP利用一种称为"横切"的技术，剖解开封装的对象内部，并将那些影响了多个类的公共行为封装到一个可重用模块

### 其他

- @Autowired表示被修饰的类需要注入对象，spring会扫描所有被@Autowired标注的类，然后根据类型在ioc容器中找到匹配的类注入
- @Repository：标注一个DAO组件类。 
- @Service：标注一个业务逻辑组件类。 
- @Controller：标注一个控制器组件类。 
- 

## 参考

- https://www.zhihu.com/question/23277575/answer/169698662
- https://snailclimb.gitee.io/javaguide/#/docs/system-design/framework/spring/SpringInterviewQuestions?id=_4-spring-ioc-amp-aop
- 